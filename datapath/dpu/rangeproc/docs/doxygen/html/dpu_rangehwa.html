<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RangeProcHWA</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<table width=100%>
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border=0 src="../../tilogo.gif"></a></td>
  <td bgcolor="red"><img src="../../titagline.gif"></td>
</tr>
</table>
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">RangeProcHWA </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#toplevel_hwa">Top Level Design</a></li>
<li class="level1"><a href="#config_hwa">Data Interface Parameter Range</a><ul><li class="level2"><a href="#autotoc_md6">ADCBuf Data Interface</a></li>
<li class="level2"><a href="#autotoc_md7">Radar Cube Data Interface</a></li>
</ul>
</li>
<li class="level1"><a href="#input_hwa">Data Input</a></li>
<li class="level1"><a href="#output_hwa">Data Output</a></li>
<li class="level1"><a href="#process_hwa">Data Processing</a><ul><li class="level2"><a href="#hwa_calibDC_Range">Antenna coupling signature removal</a></li>
</ul>
</li>
<li class="level1"><a href="#hwa_usecase">Use Cases and Implementation</a><ul><li class="level2"><a href="#hwa_impl">HWA param set Implementation</a></li>
<li class="level2"><a href="#hwa_dataIn">EDMA Data In Implementation</a></li>
<li class="level2"><a href="#hwa_dataOut">EDMA Data Out Implementation</a></li>
<li class="level2"><a href="#hwa_usecase1">Interleaved RX channel data -&gt; DPIF_RADARCUBE_FORMAT_2</a></li>
<li class="level2"><a href="#hwa_usecase2">Non-Interleaved RX channel data -&gt; DPIF_RADARCUBE_FORMAT_2</a></li>
<li class="level2"><a href="#hwa_usecase3">Non-Interleaved RX channel data(1 or 2 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</a></li>
<li class="level2"><a href="#hwa_usecase4">Isolated Non-Interleaved RX channel data(1 or 2 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</a></li>
<li class="level2"><a href="#hwa_usecase5">Isolated Non-Interleaved RX channel data(3 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="toplevel_hwa"></a>
Top Level Design</h1>
<p>Range FFT processing is done by HWA hardware. Based on the RF parameters, rangeProcHWA configures hardware accelerator FFT engine accordingly. It also configures data input and output EDMA channels to bring data in and out of range Processing memory.</p>
<p>HWA FFT process is triggered by hardware based trigger -"chirp data available" which is hooked up to HWA internally in hardware.</p>
<p>After FFT processing is done, HWA generates interrupt to rangeProcHWA DPU, at the same time triggers EDMA data output channel to copy FFT results to radarCube in configured format. EDMA interrupt done interrupt is triggered by EDMA hardware after the copy is completed.</p>
<p>DC antenna signal calibration and removal is built into the rangeProcHWA Module. If the feature is enabled, it is done after all chirps (in the frame) FFT processing is completed.</p>
<p>The following diagram shows the top level design for rangeProcHWA.</p>
<div class="image">
<img src="rangeprochwa_toplevel.png" alt=""/>
<div class="caption">
rangeProcHWA Top Level</div></div>
<p>The following diagram shows a general timing diagram for a 3 tx antenna MIMO case but can be imagined to hold for 1 or 2 tx cases as well. All use cases described in later sections have this general timing flow.</p>
<div class="image">
<img src="datapath_1d_timing.png" alt=""/>
<div class="caption">
Timing Diagram</div></div>
<h1><a class="anchor" id="config_hwa"></a>
Data Interface Parameter Range</h1>
<p>Here are supported ADCBuf and radarCube interface configurations:</p>
<h2><a class="anchor" id="autotoc_md6"></a>
ADCBuf Data Interface</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Parameter  </th><th class="markdownTableHeadCenter">Supported value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">dataFmt  </td><td class="markdownTableBodyCenter"><a class="el" href="dpif__types_8h.html#acb5c148ad8168d6c470826f5ea11b603aa799a265f231047c07903f98335a97f7">DPIF_DATAFORMAT_COMPLEX16_IMRE</a> only   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">interleave  </td><td class="markdownTableBodyCenter">interleave (<a class="el" href="dpif__adcdata_8h.html#a5a3c4d5f28cbdaf4e5f21d1a71bec7a2a6a3cf55cd8f377438ad6ee06aa9870fb">DPIF_RXCHAN_INTERLEAVE_MODE</a>) and non-interleave (<a class="el" href="dpif__adcdata_8h.html#a5a3c4d5f28cbdaf4e5f21d1a71bec7a2a9bc9d92e18630ecee50389baae437605">DPIF_RXCHAN_NON_INTERLEAVE_MODE</a>)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">numChirpsPerChirpEvent  </td><td class="markdownTableBodyCenter">1 ONLY   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numRxAntennas  </td><td class="markdownTableBodyCenter">1, 2 or 4   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">numAdcSamples  </td><td class="markdownTableBodyCenter">64 - 1024   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md7"></a>
Radar Cube Data Interface</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Parameter  </th><th class="markdownTableHeadCenter">Supported value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">datafmt  </td><td class="markdownTableBodyCenter"><a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga4f1cc2e5019a697f3cafa1cecdf3b144">DPIF_RADARCUBE_FORMAT_1</a> and <a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga52490164a754938e734d5b2fef66fe76">DPIF_RADARCUBE_FORMAT_2</a> only   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numTxAntennas  </td><td class="markdownTableBodyCenter">1, 2 and 3   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">numRangeBins  </td><td class="markdownTableBodyCenter">64 - 1024   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numChirpsPerFrame  </td><td class="markdownTableBodyCenter">As AdcBuf and HWA memory permit, numChirpsPerFrame/numTxAntennas should be an even number   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>For 1024 Range bins with 1 TX , 4 RX antenna and <a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga4f1cc2e5019a697f3cafa1cecdf3b144">DPIF_RADARCUBE_FORMAT_1</a>, it is not currently supported due to EDMA address jump limitation (jump &lt; 32768). </dd>
<dd>
For 1024 Range bins with 3 TX , 4 RX antenna and <a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga4f1cc2e5019a697f3cafa1cecdf3b144">DPIF_RADARCUBE_FORMAT_1</a>, it is not currently supported due to EDMA address jump limitation (jump &lt; 32768). </dd>
<dd>
Due to the Ping/Pong scheme implemented in rangeProcHWA DPU, numChirpsPerFrame/numTxAntennas should be an even number.</dd></dl>
<h1><a class="anchor" id="input_hwa"></a>
Data Input</h1>
<p>There are two HWA input mode supported (<a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#gab1ef0718b68cc0f9fe4e36f17a72c067">DPU_RangeProcHWA_InputMode_e</a>),</p><ul>
<li><a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#ggab1ef0718b68cc0f9fe4e36f17a72c067a53dc67330cf43a64e5832dad39140aa0">DPU_RangeProcHWA_InputMode_ISOLATED</a> : <br  />
 ADCBuf buffer and HWA memory are isolated in physical memory space. Data input EDMA channel is configured to transfer data from ADCBuf to HWA M0/M1 memory in ping/pong alternate order.</li>
<li><a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#ggab1ef0718b68cc0f9fe4e36f17a72c067a22c8a10984e4bfee8408bd7c24da07d9">DPU_RangeProcHWA_InputMode_MAPPED</a> :<br  />
 ADCBuf buffer and HWA memory are mapped. HWA can read ADC data directly. No copy is needed.</li>
</ul>
<p>Depending on the RF configuration, the data in ADCBuf can be either interleaved or non-interleaved mode.</p>
<h1><a class="anchor" id="output_hwa"></a>
Data Output</h1>
<p>RangeProcHWA configures data output EDMA channels to transfer FFT results from HWA M2/M3 to radarCube memory.</p>
<p>The following two radarCube formats are supported in rangeProcHWA.</p><ul>
<li><a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga4f1cc2e5019a697f3cafa1cecdf3b144">DPIF_RADARCUBE_FORMAT_1</a></li>
<li><a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga52490164a754938e734d5b2fef66fe76">DPIF_RADARCUBE_FORMAT_2</a></li>
</ul>
<p>The following table describes the suppoted data input and output combinations:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Interleave Mode  </th><th class="markdownTableHeadCenter">DPIF_RADARCUBE_FORMAT_1  </th><th class="markdownTableHeadCenter">DPIF_RADARCUBE_FORMAT_2   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">interleave  </td><td class="markdownTableBodyCenter">NOT supported  </td><td class="markdownTableBodyCenter">Supported   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">non-interleave  </td><td class="markdownTableBodyCenter">Supported  </td><td class="markdownTableBodyCenter">Supported   </td></tr>
</table>
<h1><a class="anchor" id="process_hwa"></a>
Data Processing</h1>
<p>Range FFT processing is done by HWA hardware. As shown in the following diagram, after <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___f_u_n_c_t_i_o_n.html#ga9e06daf8d20969470d0e622ed3335bc0">DPU_RangeProcHWA_config</a> is completed, in every frame, rangeProcHWA is triggered through <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___f_u_n_c_t_i_o_n.html#ga31b1c43fac7e0a8edb2f9fcc61e36561">DPU_RangeProcHWA_control</a> <br  />
 using command <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#gga8c25dec4f8f383a3c745d8da510aad30a2018c7b6945733bb85135605f9de77d0">DPU_RangeProcHWA_Cmd_triggerProc</a>. If the hardware resources are overlaid with other modules, <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___f_u_n_c_t_i_o_n.html#ga9e06daf8d20969470d0e622ed3335bc0">DPU_RangeProcHWA_config</a> can be called before the next frame start. <br  />
 DC signal removal configuration can be updated at inter-frame time before the next frame starts.</p>
<div class="image">
<img src="hwa_callflow.png" alt=""/>
<div class="caption">
rangeProcHWA call flow</div></div>
<h2><a class="anchor" id="hwa_calibDC_Range"></a>
Antenna coupling signature removal</h2>
<p>This feature is controlled through configuration <a class="el" href="struct_d_p_u___range_proc___calib_dc_range_sig_cfg__t.html">DPU_RangeProc_CalibDcRangeSigCfg_t</a>. The configuration can be sent to rangeProcHWA DPU through API <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___f_u_n_c_t_i_o_n.html#ga9e06daf8d20969470d0e622ed3335bc0">DPU_RangeProcHWA_config</a>. <br  />
 The configuration can also be updated at runtime through control command <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#gga8c25dec4f8f383a3c745d8da510aad30af34aae3970e0bc617b14cd6885ab3caa">DPU_RangeProcHWA_Cmd_dcRangeCfg</a>.</p>
<p>DC signal calibration and compensation is operated on radarCube directly by the CPU.</p>
<div class="image">
<img src="hwa_dcremoval.png" alt=""/>
<div class="caption">
rangeProcHWA Antenna DC signal removal</div></div>
<h1><a class="anchor" id="hwa_usecase"></a>
Use Cases and Implementation</h1>
<p>This Section describes some of the internal implementation for a few use cases with combination of input/output configurations. <br  />
 </p>
<h2><a class="anchor" id="hwa_impl"></a>
HWA param set Implementation</h2>
<p>RangeProcHWA always use 4 consecutive HWA param sets(<a class="el" href="rangeprochwa_8h.html#ac725afeda9232deb7624d60a48309e9d">DPU_RANGEPROCHWA_NUM_HWA_PARAM_SETS</a>) starting from paramSetStartIdx, these params will be labeled PARAM_0, PARAM_1, PARAM_2 and PARAM_3 from now onwards for convenience of explanation and picture representation. Param sets are used in two parallel processing chain in ping/pong alternate manner. PARAM_0 and PARAM_1 are used for PING and PARAM_2 and PARAM_3 are used for PONG.</p>
<p>PARAM_0 and PARAM_2 need to be activated by triggers to protect internal data memory integrity. There are initially triggered by software when starting the very first chirp. Consequently they are triggered by data out hot signature channel. PARAM_1 and PARAM_3 are Range FFT param sets for PING and PONG respectively. In directly mapped input mode, they are triggered by frontend hardware when chirp data is available. In isolated input mode, they are triggered by data in hot signature. After range FFT processing is done in HWA, HWA param sets automatically trigger data out EDMA channel to copy data to radar Cube in desired radarCube format.</p>
<h2><a class="anchor" id="hwa_dataIn"></a>
EDMA Data In Implementation</h2>
<p>When enabled, data input EDMA is constructed utilizing two EDMA channels. The first EDMA channel copies data from ADCBuf buffer to HWA memory. The second EDMA channel is chained to the first channel. It copies hot signature to trigger range FFT param sets.<br  />
 In summary, the data in EDMA requires the following resources: </p><pre class="fragment"> - 1 EDMA channel with 1 shadow channel
 - 1 hot Signature channel with 1 shadow channel
</pre><h2><a class="anchor" id="hwa_dataOut"></a>
EDMA Data Out Implementation</h2>
<p>Data out EDMA is responsible for copying data from HWA memory to radar Cube memory. It has two formats (<a class="el" href="struct_d_p_u___range_proc_h_w_a___e_d_m_a_output_config__t.html">DPU_RangeProcHWA_EDMAOutputConfig_t</a>).<br  />
 <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#ga87a51448bb00e451c837b590df405150">DPU_RangeProcHWA_EDMAOutputConfigFmt2</a> is only for the following configuration: <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Setting  </th><th class="markdownTableHeadCenter">Note   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">DPIF_RADARCUBE_FORMAT_1  </td><td class="markdownTableBodyCenter">Radar Cube format 1   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numTxAntenna  </td><td class="markdownTableBodyCenter">3 TX antenna   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">DPIF_RXCHAN_NON_INTERLEAVE_MODE  </td><td class="markdownTableBodyCenter">ADCBuf non interleave mode   </td></tr>
</table>
<p>All other configurations should use <a class="el" href="struct_d_p_u___range_proc_h_w_a___e_d_m_a_output_config_fmt1__t.html">DPU_RangeProcHWA_EDMAOutputConfigFmt1_t</a>.</p>
<p>For EDMA dataOut Fmt1, it needs three EDMA channels, shown as follows: </p><pre class="fragment"> Ping:
 - 1 EDMA channel with 1 shadow channel

 Pong:
 - 1 EDMA channel with 1 shadow channel

 Signature channel:
 - 1 HWA hot signature channel with 1 shadow channel
</pre><p>Ping and Pong EDMA channels are triggered by PARAM_1 and PARAM_3 FFT automatically. Both Ping/pong EDMA channels are chained to data out Hot Signature channel, which triggers HWA PARAM_0 AND PARAM_2 when EDMA channel copy is completed.</p>
<p>For EDMA dataOut Fmt2, it requires the following resources:<br  />
</p><pre class="fragment"> Ping:
 - 1 dummy EDMA channel with 3 shadow channels
 - 3 dataOut channel, each has a shadow channel

 Pong:
 - 1 dummy EDMA channel with 3 shadow channels
 - 3 dataOut channel, each has a shadow channel

 Signature channel:
 - 1 HWA hot signature channel with 1 shadow channel
</pre><p>The dummy EDMA channel is triggered by the HWA PARAM_1(trigger data out Ping EDMA channel) and PARAM_3(trigger data out pong EDMA channel) after FFT operation is completed. The dummy channel is linked to 3 shadow channels. The shadow channel is loaded to dummy channel in round robin order. Each dummy channel is chained to one of the 3 dataOut channel that have different source and destination address. Details are as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Index  </th><th class="markdownTableHeadCenter">Source Address  </th><th class="markdownTableHeadCenter">Destination Address  </th><th class="markdownTableHeadCenter">sequence order in time   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">PING 1  </td><td class="markdownTableBodyCenter">HWA M2  </td><td class="markdownTableBodyCenter">TX1  </td><td class="markdownTableBodyCenter">1   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PING 2  </td><td class="markdownTableBodyCenter">HWA M2  </td><td class="markdownTableBodyCenter">TX3  </td><td class="markdownTableBodyCenter">3   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">PING 3  </td><td class="markdownTableBodyCenter">HWA M2  </td><td class="markdownTableBodyCenter">TX2  </td><td class="markdownTableBodyCenter">5   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PONG 1  </td><td class="markdownTableBodyCenter">HWA M3  </td><td class="markdownTableBodyCenter">TX2  </td><td class="markdownTableBodyCenter">2   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">PONG 2  </td><td class="markdownTableBodyCenter">HWA M3  </td><td class="markdownTableBodyCenter">TX1  </td><td class="markdownTableBodyCenter">4   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PONG 3  </td><td class="markdownTableBodyCenter">HWA M3  </td><td class="markdownTableBodyCenter">TX3  </td><td class="markdownTableBodyCenter">6   </td></tr>
</table>
<h2><a class="anchor" id="hwa_usecase1"></a>
Interleaved RX channel data -&gt; DPIF_RADARCUBE_FORMAT_2</h2>
<p>This use case is for configuration with a directly mapped input buffer with interleaved ADC data. After Range FFT, data is saved in radar cube with format:<a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga52490164a754938e734d5b2fef66fe76">DPIF_RADARCUBE_FORMAT_2</a>.</p>
<p>DataIn EDMA is NOT required, DataOut EDMA should be configured with format DPU_RangeProcHWA_EDMAOutputConfigFmt2.<br  />
</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Input params  </th><th class="markdownTableHeadCenter">Setting   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">InterleaveMode  </td><td class="markdownTableBodyCenter">Interleave   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">HWA input mode  </td><td class="markdownTableBodyCenter">Mapped   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RadarCube format  </td><td class="markdownTableBodyCenter">DPIF_RADARCUBE_FORMAT_2   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numTxAnt  </td><td class="markdownTableBodyCenter">1, 2, 3   </td></tr>
</table>
<div class="image">
<img src="interleave_to_radarcubefmt2.png" alt=""/>
<div class="caption">
Interleaved data input to DPIF_RADARCUBE_FORMAT_2</div></div>
<p>Above picture illustrates a case of three transmit antennas, chirping within the frame with repeating pattern of (Tx1,Tx3,Tx2). This is the 3D profile (velocity and x,y,z) case. There are 4 rx antennas, the samples of which are color-coded and labeled as 1,2,3,4 with unique coloring for each of chirps that are processed in ping-pong manner to parallelize accelerator and EDMA processing with sample acquisition from ADC. The hardware accelerator's parameter RAMs are setup to do FFT which operates on the input ADC ping and pong buffers to produce output in M2 and M3 memories of the HWA. The processing needs to be given a kick every frame, this is done by the range DPU user by issuing the IOCTL command code <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#gga8c25dec4f8f383a3c745d8da510aad30a2018c7b6945733bb85135605f9de77d0">DPU_RangeProcHWA_Cmd_triggerProc</a> (this invokes <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___i_n_t_e_r_n_a_l___f_u_n_c_t_i_o_n.html#ga848a25b3b110dc988f34423505bf2a4f">rangeProcHWA_TriggerHWA</a>) which activates the HWA's dummy params PARAM_0 (ping) and PARAM_2 (pong) which in turn activate the processing PARAMs PARAM_1 (ping) and PARAM_3 (pong), these are waiting on the ADC full signal. When ADC has samples to process in the ADC buffer Ping or Pong memories, the corresponding processing PARAM will trigger FFT calculation and transfer the FFT output into the M2 or M3 memories. Before ADC samples are sent to FFT engine, the configured FFT window is applied to them in the HWA. The completion of FFT triggers the Data Out Ping/Pong EDMAs which have been setup to do a copy with transposition from the M2/M3 memories to the L3 RAM (Radar Cube) as shown in the picture. This HWA-EDMA ping-pong processing is done DPU_RangeProcHWA_StaticConfig_t::numChirpsPerFrame/2(ping/pong) times so that all chirps of the frame are processed. The EDMA is setup such that Data Out EDMAs are both chained to the Data Out Signature EDMA. So the Data Out Signature EDMA will trigger when the FFT result in M2/M3 memories is transferred to the radar cube. This signature EDMA is setup to trigger the dummy PARAMs. Even though the signature EDMA is a single EDMA channel, it is setup to alternate between the two dummy PARAMs so in effect when ping data out transfer is done, the ping dummy PARAM (PARAM_0) will be activated and when pong is done, the pong dummy PARAM (PARAM_2) will be activated. The signature EDMA is setup to give a completion interrupt after the last chirp which notifies software that range DPU processing is complete and user can trigger processing again for the next chirping period when the time comes. The shadow (link) PaRAMs of EDMA are used for reloading the PaRAMs so reprogramming is avoided. The blue arrows between EDMA blocks indicate linking and red arrows indicate chaining.</p>
<p>In further use cases, we do not describe the diagrams in such detail but the the general flow is similar. Details differ mostly in the programming of HWA and the amount of EDMA resources and their programming to handle the desired input and output formats.</p>
<h2><a class="anchor" id="hwa_usecase2"></a>
Non-Interleaved RX channel data -&gt; DPIF_RADARCUBE_FORMAT_2</h2>
<p>This use case is for configuration with a directly mapped input buffer with non-interleaved ADC data. After Range FFT, data is saved in radar cube with format:DPIF_RADARCUBE_FORMAT_2.<br  />
 A conversion of data from non-interleaved format to interleaved format is done by PARAM_1 AND PARAM_3.</p>
<p>DataIn EDMA is NOT required, DataOut EDMA should be configured with format DPU_RangeProcHWA_EDMAOutputConfigFmt2.<br  />
</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Input params  </th><th class="markdownTableHeadCenter">Setting   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">InterleaveMode  </td><td class="markdownTableBodyCenter">Non-Interleave   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">HWA input mode  </td><td class="markdownTableBodyCenter">Mapped   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RadarCube format  </td><td class="markdownTableBodyCenter">DPIF_RADARCUBE_FORMAT_2   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numTxAnt  </td><td class="markdownTableBodyCenter">1, 2, 3   </td></tr>
</table>
<div class="image">
<img src="non-interleave_to_radarcubefmt2.png" alt=""/>
<div class="caption">
Non-interleaved data input to DPIF_RADARCUBE_FORMAT_2</div></div>
<h2><a class="anchor" id="hwa_usecase3"></a>
Non-Interleaved RX channel data(1 or 2 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</h2>
<p>This use case is for configuration with a directly mapped input buffer with non-interleaved ADC data. After RangeFFT, data is saved in radar cube with format:<a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga4f1cc2e5019a697f3cafa1cecdf3b144">DPIF_RADARCUBE_FORMAT_1</a>.</p>
<p>DataIn EDMA is NOT required, DataOut EDMA should be configured with format DPU_RangeProcHWA_EDMAOutputConfigFmt2.<br  />
 The diagram shows radarCube in 2 TX Antenna format. The output of Ping will be saved in TX1 section and output of Pong will be saved in TX2 section of the radar cube. For one TX antenna case, data from ping and pong data will be saved in TX1 radar cube in alternate order.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Input params  </th><th class="markdownTableHeadCenter">Setting   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">InterleaveMode  </td><td class="markdownTableBodyCenter">Non-Interleave   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">HWA input mode  </td><td class="markdownTableBodyCenter">Mapped   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RadarCube format  </td><td class="markdownTableBodyCenter">DPIF_RADARCUBE_FORMAT_1   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numTxAnt  </td><td class="markdownTableBodyCenter">1, 2   </td></tr>
</table>
<div class="image">
<img src="non-interleave_to_radarcubefmt1.png" alt=""/>
<div class="caption">
Non-interleaved data input to DPIF_RADARCUBE_FORMAT_1</div></div>
<h2><a class="anchor" id="hwa_usecase4"></a>
Isolated Non-Interleaved RX channel data(1 or 2 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</h2>
<p>This use case is for configuration with isolated input buffer with non-interleaved ADC data. After RangeFFT, data is saved in radar cube with format:<a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga4f1cc2e5019a697f3cafa1cecdf3b144">DPIF_RADARCUBE_FORMAT_1</a>. <br  />
 DataIn EDMA is required, DataOut EDMA should be configured with format <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#ga87a51448bb00e451c837b590df405150">DPU_RangeProcHWA_EDMAOutputConfigFmt2</a> <br  />
 The diagram shows radarCube in 2 TX Antenna format. The output of Ping will be saved in TX1 section and output of Pong will be saved in TX2 section of the radar cube. For one TX antenna case, data from ping and pong will be saved in TX1 radar cube in alternate order.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Input params  </th><th class="markdownTableHeadCenter">Setting   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">InterleaveMode  </td><td class="markdownTableBodyCenter">Non-Interleave   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">HWA input mode  </td><td class="markdownTableBodyCenter">Isolated   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RadarCube format  </td><td class="markdownTableBodyCenter">DPIF_RADARCUBE_FORMAT_1   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numTxAnt  </td><td class="markdownTableBodyCenter">1, 2   </td></tr>
</table>
<div class="image">
<img src="isolated_non-interleave_to_radarcubefmt1.png" alt=""/>
<div class="caption">
Isolated Non-interleaved data input to DPIF_RADARCUBE_FORMAT_1</div></div>
<h2><a class="anchor" id="hwa_usecase5"></a>
Isolated Non-Interleaved RX channel data(3 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</h2>
<p>This use case is for configuration with isolated input buffer with non-interleaved ADC data. After RangeFFT, data is saved in radar cube with format:DPIF_RADARCUBE_FORMAT_1.<br  />
 DataIn EDMA is required, DataOut EDMA should be configured with format DPU_RangeProcHWA_EDMAOutputConfigFmt1.<br  />
</p>
<p>The output of Ping/Pong FFT results will be saved in radar cube as follows: Ping 1 (first dataOut EDMA channel) data will goto odd number doppler chirps in TX1, as shown in dark grey arrow) Ping 2 (second dataOut EDMA channel) data will goto odd number doppler chirps in TX3, as shown in light blue arrow) Ping 3 (third dataOut EDMA channel) data will goto even number doppler chirps in TX2, as shown in peach arrow)</p>
<p>Pong 1 (first dataOut EDMA channel) data will goto odd number doppler chirps in TX2, as shown in dark green arrow) Pong 2 (second dataOut EDMA channel) data will goto even number doppler chirps in TX1, as shown in light green arrow) Pong 3 (third dataOut EDMA channel) data will goto even number doppler chirps in TX3, as shown in blue arrow)</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Input params  </th><th class="markdownTableHeadCenter">Setting   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">InterleaveMode  </td><td class="markdownTableBodyCenter">Non-Interleave   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">HWA input mode  </td><td class="markdownTableBodyCenter">Isolated   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RadarCube format  </td><td class="markdownTableBodyCenter">DPIF_RADARCUBE_FORMAT_1   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">numTxAnt  </td><td class="markdownTableBodyCenter">3   </td></tr>
</table>
<div class="image">
<img src="isolated_non-interleave_to_radarcubefmt1_3tx.png" alt=""/>
<div class="caption">
3 TX Isolated Non-interleaved data input to DPIF_RADARCUBE_FORMAT_1</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<hr size="1"><small>
Copyright  2024, Texas Instruments Incorporated</small>
</body>
</html>
